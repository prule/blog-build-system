<!DOCTYPE html>
<html lang="en">
<head>
    {{> head}}
    <style>
        .filter-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        #search-input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }

        .note {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .note:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
{{> header}}

<div class="container">
    <main>
        <section id="notes">
            <div class="section-header">
                <h2>Notes Archive</h2>
                <p>Browse through all my notes, or use the search to find something specific.</p>
            </div>

            <div class="filter-controls">
                <div class="filter-row">
                    <input type="text" id="search-input" placeholder="Search notes...">
                    <div class="sort-select-wrapper">
                        <select id="sort-select">
                            <option value="newest">Sort by Newest</option>
                            <option value="oldest">Sort by Oldest</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="notes-container">
                {{#notes}}
                    <div class="note">
                        <div class="note-content">{{{content}}}</div>
                        <div class="note-meta">
                            <span>{{modifiedDate}}</span>
                        </div>
                    </div>
                {{/notes}}
                <p id="no-results" class="no-results" style="display: none;">No notes found.</p>
            </div>
        </section>
    </main>
</div>

{{> footer}}

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('search-input');
        const sortSelect = document.getElementById('sort-select');
        const notesContainer = document.getElementById('notes-container');
        const noResults = document.getElementById('no-results');
        const notes = Array.from(notesContainer.getElementsByClassName('note'));

        const debounce = (func, delay) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        };

        const filterAndSortNotes = () => {
            const searchTerm = searchInput.value.toLowerCase();
            const sortOrder = sortSelect.value;

            let visibleNotesCount = 0;

            const sortedNotes = [...notes].sort((a, b) => {
                const dateA = new Date(a.querySelector('.note-meta span').textContent);
                const dateB = new Date(b.querySelector('.note-meta span').textContent);
                return sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
            });

            sortedNotes.forEach(note => notesContainer.appendChild(note));

            sortedNotes.forEach(note => {
                const noteContent = note.querySelector('.note-content').textContent.toLowerCase();

                if (noteContent.includes(searchTerm)) {
                    note.style.display = 'block';
                    visibleNotesCount++;
                } else {
                    note.style.display = 'none';
                }
            });

            noResults.style.display = visibleNotesCount === 0 ? 'block' : 'none';
        };

        searchInput.addEventListener('input', debounce(filterAndSortNotes, 300));
        sortSelect.addEventListener('change', filterAndSortNotes);

        filterAndSortNotes(); // Initial filter and sort on page load
    });
</script>

</body>
</html>
